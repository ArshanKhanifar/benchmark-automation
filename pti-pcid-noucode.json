{
	"command_once": [
	],
	"common_setup": [
		"sed -i '.bak' '/.*pti=[01]$/d' /boot/loader.conf",
		"sed -i '.bak' '/.*pcid_enabled=[01]$/d' /boot/loader.conf"
	],
	"common_commands": [
		"if ! kldstat -n cpuctl -q; then kldload cpuctl; fi",
		"cpucontrol -e /dev/cpuctl10",

		"sysctl vm.pmap > output/pmap.log",
		"uname -a > output/uname.log",
		"kenv | grep \"^smbios\\.\" > output/kenv.log",
		"dmesg > output/dmesg.log",
		"x86info -a > output/x86info.log",

		"mount -t tmpfs tmpfs /usr/src",
		"mount -t tmpfs tmpfs /usr/obj",
		"cp -r /usr/tmp.src/. /usr/src",

		"for i in $(jot 3); do rm -rf /usr/obj/*; /usr/bin/time -o output/buildtime.$i.log sh -c \"make -C /usr/src/tools/tools/syscall_timing clean; make -C /usr/src/tools/tools/syscall_timing > output/build.$i.log 2>&1\"; done"
	],
	"benchmarks": [
		{
			"name": "pti-0-pcid-0",
			"setup": [
				"echo 'vm.pmap.pti=0' >> /boot/loader.conf",
				"echo 'vm.pmap.pcid_enabled=0' >> /boot/loader.conf"
			],
			"needs_reboot": false
		},
		{
			"name": "pti-0-pcid-1",
			"setup": [
				"echo 'vm.pmap.pti=0' >> /boot/loader.conf",
				"echo 'vm.pmap.pcid_enabled=1' >> /boot/loader.conf"
			],
			"needs_reboot": false
		},
		{
			"name": "pti-1-pcid-1",
			"setup": [
				"echo 'vm.pmap.pti=1' >> /boot/loader.conf",
				"echo 'vm.pmap.pcid_enabled=1' >> /boot/loader.conf"
			],
			"needs_reboot": false
		},
		{
			"name": "pti-1-pcid-0",
			"setup": [
				"echo 'vm.pmap.pti=1' >> /boot/loader.conf",
				"echo 'vm.pmap.pcid_enabled=0' >> /boot/loader.conf"
			],
			"needs_reboot": false
		}
	]
}

